<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Poseidon.Chronicle</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Poseidon.EntityTypes.html"><span class="hs-identifier">Poseidon.EntityTypes</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.EntityTypes.html#HasNameAndVersion"><span class="hs-identifier">HasNameAndVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Poseidon.Package.html"><span class="hs-identifier">Poseidon.Package</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.Package.html#PoseidonPackage"><span class="hs-identifier">PoseidonPackage</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Poseidon.Utils.html"><span class="hs-identifier">Poseidon.Utils</span></a></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.Utils.html#Env"><span class="hs-identifier">Env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Poseidon.Utils.html#PoseidonException"><span class="hs-identifier">PoseidonException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>                                         </span><span class="annot"><a href="Poseidon.Utils.html#PoseidonIO"><span class="hs-identifier">PoseidonIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Poseidon.Utils.html#TestMode"><span class="hs-identifier">TestMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Poseidon.Version.html"><span class="hs-identifier">Poseidon.Version</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.Version.html#VersionComponent"><span class="hs-identifier">VersionComponent</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>                                         </span><span class="annot"><a href="Poseidon.Version.html#updateThreeComponentVersion"><span class="hs-identifier">updateThreeComponentVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Catch</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwM</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">asks</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromJSON</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToJSON</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">object</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">parseJSON</span></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>                                         </span><span class="annot"><span class="hs-identifier">toJSON</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withObject</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.!=)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.:)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.:?)</span></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>                                         </span><span class="annot"><span class="hs-operator">(.=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">elemIndex</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Time</span></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Day</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">UTCTime</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getCurrentTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Version</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Version</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makeVersion</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Yaml</span></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeEither'</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Yaml.Pretty</span></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">defConfig</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encodePretty</span></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>                                         </span><span class="annot"><span class="hs-identifier">setConfCompare</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">setConfDropNull</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GitHash</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getGitInfo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">giHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">createDirectoryIfMissing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makeAbsolute</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">makeRelative</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeDirectory</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">data</span><span> </span><span id="PoseidonPackageChronicle"><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-var">PoseidonPackageChronicle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PoseidonPackageChronicle"><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-var">PoseidonPackageChronicle</span></a></span></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="snapYamlTitle"><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; String
</span><a href="Poseidon.Chronicle.html#snapYamlTitle"><span class="hs-identifier hs-var hs-var">snapYamlTitle</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="snapYamlDescription"><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Maybe String
</span><a href="Poseidon.Chronicle.html#snapYamlDescription"><span class="hs-identifier hs-var hs-var">snapYamlDescription</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="snapYamlChronicleVersion"><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Version
</span><a href="Poseidon.Chronicle.html#snapYamlChronicleVersion"><span class="hs-identifier hs-var hs-var">snapYamlChronicleVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Version</span></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="snapYamlLastModified"><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Day
</span><a href="Poseidon.Chronicle.html#snapYamlLastModified"><span class="hs-identifier hs-var hs-var">snapYamlLastModified</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Day</span></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="snapYamlPackages"><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Set PackageIteration
</span><a href="Poseidon.Chronicle.html#snapYamlPackages"><span class="hs-identifier hs-var hs-var">snapYamlPackages</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679503555"><span id="local-6989586621679503569"><span id="local-6989586621679503573"><span class="annot"><span class="annottext">Int -&gt; PoseidonPackageChronicle -&gt; ShowS
[PoseidonPackageChronicle] -&gt; ShowS
PoseidonPackageChronicle -&gt; String
(Int -&gt; PoseidonPackageChronicle -&gt; ShowS)
-&gt; (PoseidonPackageChronicle -&gt; String)
-&gt; ([PoseidonPackageChronicle] -&gt; ShowS)
-&gt; Show PoseidonPackageChronicle
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PoseidonPackageChronicle -&gt; ShowS
showsPrec :: Int -&gt; PoseidonPackageChronicle -&gt; ShowS
$cshow :: PoseidonPackageChronicle -&gt; String
show :: PoseidonPackageChronicle -&gt; String
$cshowList :: [PoseidonPackageChronicle] -&gt; ShowS
showList :: [PoseidonPackageChronicle] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679503578"><span id="local-6989586621679503588"><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; PoseidonPackageChronicle -&gt; Bool
(PoseidonPackageChronicle -&gt; PoseidonPackageChronicle -&gt; Bool)
-&gt; (PoseidonPackageChronicle -&gt; PoseidonPackageChronicle -&gt; Bool)
-&gt; Eq PoseidonPackageChronicle
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PoseidonPackageChronicle -&gt; PoseidonPackageChronicle -&gt; Bool
== :: PoseidonPackageChronicle -&gt; PoseidonPackageChronicle -&gt; Bool
$c/= :: PoseidonPackageChronicle -&gt; PoseidonPackageChronicle -&gt; Bool
/= :: PoseidonPackageChronicle -&gt; PoseidonPackageChronicle -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679503594"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-42"></span><span>    </span><span id="local-6989586621679503623"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser PoseidonPackageChronicle
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Object -&gt; Parser PoseidonPackageChronicle)
-&gt; Value
-&gt; Parser PoseidonPackageChronicle
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PoseidonYamlStruct&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser PoseidonPackageChronicle)
 -&gt; Value -&gt; Parser PoseidonPackageChronicle)
-&gt; (Object -&gt; Parser PoseidonPackageChronicle)
-&gt; Value
-&gt; Parser PoseidonPackageChronicle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679503624"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503624"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Maybe String
-&gt; Version
-&gt; Day
-&gt; Set PackageIteration
-&gt; PoseidonPackageChronicle
</span><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-var">PoseidonPackageChronicle</span></a></span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><span class="annottext">(String
 -&gt; Maybe String
 -&gt; Version
 -&gt; Day
 -&gt; Set PackageIteration
 -&gt; PoseidonPackageChronicle)
-&gt; Parser String
-&gt; Parser
     (Maybe String
      -&gt; Version
      -&gt; Day
      -&gt; Set PackageIteration
      -&gt; PoseidonPackageChronicle)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser String
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span>  </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;title&quot;</span></span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><span class="annottext">Parser
  (Maybe String
   -&gt; Version
   -&gt; Day
   -&gt; Set PackageIteration
   -&gt; PoseidonPackageChronicle)
-&gt; Parser (Maybe String)
-&gt; Parser
     (Version
      -&gt; Day -&gt; Set PackageIteration -&gt; PoseidonPackageChronicle)
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe String)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;description&quot;</span></span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><span class="annottext">Parser
  (Version
   -&gt; Day -&gt; Set PackageIteration -&gt; PoseidonPackageChronicle)
-&gt; Parser Version
-&gt; Parser (Day -&gt; Set PackageIteration -&gt; PoseidonPackageChronicle)
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Version
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span>  </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;chronicleVersion&quot;</span></span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><span class="annottext">Parser (Day -&gt; Set PackageIteration -&gt; PoseidonPackageChronicle)
-&gt; Parser Day
-&gt; Parser (Set PackageIteration -&gt; PoseidonPackageChronicle)
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Day
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span>  </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;lastModified&quot;</span></span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><span class="annottext">Parser (Set PackageIteration -&gt; PoseidonPackageChronicle)
-&gt; Parser (Set PackageIteration) -&gt; Parser PoseidonPackageChronicle
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (Maybe (Set PackageIteration))
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser (Maybe a)
</span><span class="hs-operator hs-var">.:?</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;packages&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser (Maybe (Set PackageIteration))
-&gt; Set PackageIteration -&gt; Parser (Set PackageIteration)
forall a. Parser (Maybe a) -&gt; a -&gt; Parser a
</span><span class="hs-operator hs-var">.!=</span></span><span> </span><span class="annot"><span class="annottext">Set PackageIteration
forall a. Set a
</span><span class="hs-identifier hs-var">S.empty</span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679503629"><span id="local-6989586621679503632"><span id="local-6989586621679503635"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-50"></span><span>    </span><span id="local-6989586621679503667"><span class="annot"><span class="annottext">toJSON :: PoseidonPackageChronicle -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span id="local-6989586621679503668"><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503668"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="annot"><span class="annottext">([Pair] -&gt; Value) -&gt; [Pair] -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;title&quot;</span></span><span>            </span><span class="annot"><span class="annottext">Key -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; String
</span><a href="Poseidon.Chronicle.html#snapYamlTitle"><span class="hs-identifier hs-var">snapYamlTitle</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503668"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;description&quot;</span></span><span>      </span><span class="annot"><span class="annottext">Key -&gt; Maybe String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Maybe String
</span><a href="Poseidon.Chronicle.html#snapYamlDescription"><span class="hs-identifier hs-var">snapYamlDescription</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503668"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;chronicleVersion&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Version -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Version
</span><a href="Poseidon.Chronicle.html#snapYamlChronicleVersion"><span class="hs-identifier hs-var">snapYamlChronicleVersion</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503668"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;lastModified&quot;</span></span><span>     </span><span class="annot"><span class="annottext">Key -&gt; Day -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Day
</span><a href="Poseidon.Chronicle.html#snapYamlLastModified"><span class="hs-identifier hs-var">snapYamlLastModified</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503668"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; [Pair] -&gt; [Pair]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-55"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set PackageIteration -&gt; Bool
forall a. Set a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Set PackageIteration
</span><a href="Poseidon.Chronicle.html#snapYamlPackages"><span class="hs-identifier hs-var">snapYamlPackages</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503668"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;packages&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Set PackageIteration -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Set PackageIteration
</span><a href="Poseidon.Chronicle.html#snapYamlPackages"><span class="hs-identifier hs-var">snapYamlPackages</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503668"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="annot"><span class="hs-comment">-- | A data type to represent a package state</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">data</span><span> </span><span id="PackageIteration"><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-var">PackageIteration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PackageIteration"><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-var">PackageIteration</span></a></span></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="pacStateTitle"><span class="annot"><span class="annottext">PackageIteration -&gt; String
</span><a href="Poseidon.Chronicle.html#pacStateTitle"><span class="hs-identifier hs-var hs-var">pacStateTitle</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ the title of the package</span></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pacStateVersion"><span class="annot"><span class="annottext">PackageIteration -&gt; Version
</span><a href="Poseidon.Chronicle.html#pacStateVersion"><span class="hs-identifier hs-var hs-var">pacStateVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Version</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the version of the package</span></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pacStateCommit"><span class="annot"><span class="annottext">PackageIteration -&gt; String
</span><a href="Poseidon.Chronicle.html#pacStateCommit"><span class="hs-identifier hs-var hs-var">pacStateCommit</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ the hash of a relevant commit where a package can be accessed in this version</span></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pacStatePath"><span class="annot"><span class="annottext">PackageIteration -&gt; String
</span><a href="Poseidon.Chronicle.html#pacStatePath"><span class="hs-identifier hs-var hs-var">pacStatePath</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ the file path where the POSEIDON.yml file is stored</span></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679503678"><span id="local-6989586621679503685"><span id="local-6989586621679503688"><span class="annot"><span class="annottext">Int -&gt; PackageIteration -&gt; ShowS
[PackageIteration] -&gt; ShowS
PackageIteration -&gt; String
(Int -&gt; PackageIteration -&gt; ShowS)
-&gt; (PackageIteration -&gt; String)
-&gt; ([PackageIteration] -&gt; ShowS)
-&gt; Show PackageIteration
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PackageIteration -&gt; ShowS
showsPrec :: Int -&gt; PackageIteration -&gt; ShowS
$cshow :: PackageIteration -&gt; String
show :: PackageIteration -&gt; String
$cshowList :: [PackageIteration] -&gt; ShowS
showList :: [PackageIteration] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679503692"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span> </span><span id="local-6989586621679503696"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503696"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679503697"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503697"><span class="hs-identifier hs-var">v1</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679503698"><span class="annot"><span class="annottext">== :: PackageIteration -&gt; PackageIteration -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span> </span><span id="local-6989586621679503699"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503699"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621679503700"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503700"><span class="hs-identifier hs-var">v2</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503696"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503699"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503697"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503700"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679503706"><span id="local-6989586621679503709"><span id="local-6989586621679503712"><span id="local-6989586621679503715"><span id="local-6989586621679503718"><span id="local-6989586621679503721"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span> </span><span id="local-6989586621679503732"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503732"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679503733"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503733"><span class="hs-identifier hs-var">v1</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679503734"><span class="annot"><span class="annottext">compare :: PackageIteration -&gt; PackageIteration -&gt; Ordering
</span><a href="#local-6989586621679503734"><span class="hs-operator hs-var hs-var hs-var hs-var">`compare`</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span> </span><span id="local-6989586621679503736"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503736"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621679503737"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503737"><span class="hs-identifier hs-var">v2</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503732"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503733"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, Version) -&gt; (String, Version) -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503736"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503737"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679503740"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621679503755"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser PackageIteration
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Object -&gt; Parser PackageIteration)
-&gt; Value
-&gt; Parser PackageIteration
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;packages&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser PackageIteration)
 -&gt; Value -&gt; Parser PackageIteration)
-&gt; (Object -&gt; Parser PackageIteration)
-&gt; Value
-&gt; Parser PackageIteration
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679503756"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503756"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Version -&gt; String -&gt; String -&gt; PackageIteration
</span><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-var">PackageIteration</span></a></span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="annottext">(String -&gt; Version -&gt; String -&gt; String -&gt; PackageIteration)
-&gt; Parser String
-&gt; Parser (Version -&gt; String -&gt; String -&gt; PackageIteration)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503756"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser String
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;title&quot;</span></span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><span class="annottext">Parser (Version -&gt; String -&gt; String -&gt; PackageIteration)
-&gt; Parser Version -&gt; Parser (String -&gt; String -&gt; PackageIteration)
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503756"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser Version
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;version&quot;</span></span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><span class="annottext">Parser (String -&gt; String -&gt; PackageIteration)
-&gt; Parser String -&gt; Parser (String -&gt; PackageIteration)
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503756"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser String
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;commit&quot;</span></span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="annottext">Parser (String -&gt; PackageIteration)
-&gt; Parser String -&gt; Parser PackageIteration
forall a b. Parser (a -&gt; b) -&gt; Parser a -&gt; Parser b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679503756"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser String
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;path&quot;</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679503759"><span id="local-6989586621679503762"><span id="local-6989586621679503765"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-80"></span><span>    </span><span id="local-6989586621679503782"><span class="annot"><span class="annottext">toJSON :: PackageIteration -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span id="local-6989586621679503783"><span class="annot"><span class="annottext">PackageIteration
</span><a href="#local-6989586621679503783"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-81"></span><span>          </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;title&quot;</span></span><span>   </span><span class="annot"><span class="annottext">Key -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">PackageIteration -&gt; String
</span><a href="Poseidon.Chronicle.html#pacStateTitle"><span class="hs-identifier hs-var">pacStateTitle</span></a></span><span> </span><span class="annot"><span class="annottext">PackageIteration
</span><a href="#local-6989586621679503783"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-82"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;version&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Version -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">PackageIteration -&gt; Version
</span><a href="Poseidon.Chronicle.html#pacStateVersion"><span class="hs-identifier hs-var">pacStateVersion</span></a></span><span> </span><span class="annot"><span class="annottext">PackageIteration
</span><a href="#local-6989586621679503783"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-83"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;commit&quot;</span></span><span>  </span><span class="annot"><span class="annottext">Key -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">PackageIteration -&gt; String
</span><a href="Poseidon.Chronicle.html#pacStateCommit"><span class="hs-identifier hs-var">pacStateCommit</span></a></span><span> </span><span class="annot"><span class="annottext">PackageIteration
</span><a href="#local-6989586621679503783"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-84"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;path&quot;</span></span><span>    </span><span class="annot"><span class="annottext">Key -&gt; String -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">PackageIteration -&gt; String
</span><a href="Poseidon.Chronicle.html#pacStatePath"><span class="hs-identifier hs-var">pacStatePath</span></a></span><span> </span><span class="annot"><span class="annottext">PackageIteration
</span><a href="#local-6989586621679503783"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Poseidon.EntityTypes.html#HasNameAndVersion"><span class="hs-identifier hs-type">HasNameAndVersion</span></a></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621679503790"><span class="annot"><span class="annottext">getPacName :: PackageIteration -&gt; String
</span><a href="#local-6989586621679503790"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPacName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span> </span><span id="local-6989586621679503792"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503792"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503792"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621679503793"><span class="annot"><span class="annottext">getPacVersion :: PackageIteration -&gt; Maybe Version
</span><a href="#local-6989586621679503793"><span class="hs-identifier hs-var hs-var hs-var hs-var">getPacVersion</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679503795"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503795"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; Maybe Version
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503795"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Poseidon.Chronicle.html#updateChronicle"><span class="hs-identifier hs-type">updateChronicle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span><span>
</span><span id="line-92"></span><span id="updateChronicle"><span class="annot"><span class="annottext">updateChronicle :: PoseidonPackageChronicle
-&gt; PoseidonPackageChronicle -&gt; PoseidonPackageChronicle
</span><a href="Poseidon.Chronicle.html#updateChronicle"><span class="hs-identifier hs-var hs-var">updateChronicle</span></a></span></span><span> </span><span id="local-6989586621679503797"><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503797"><span class="hs-identifier hs-var">oldChronicle</span></a></span></span><span> </span><span id="local-6989586621679503798"><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503798"><span class="hs-identifier hs-var">newChronicle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679503799"><span class="annot"><span class="annottext">oldPackageSet :: Set PackageIteration
</span><a href="#local-6989586621679503799"><span class="hs-identifier hs-var hs-var">oldPackageSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Set PackageIteration
</span><a href="Poseidon.Chronicle.html#snapYamlPackages"><span class="hs-identifier hs-var">snapYamlPackages</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503797"><span class="hs-identifier hs-var">oldChronicle</span></a></span><span>
</span><span id="line-94"></span><span>        </span><span id="local-6989586621679503800"><span class="annot"><span class="annottext">newPackageSet :: Set PackageIteration
</span><a href="#local-6989586621679503800"><span class="hs-identifier hs-var hs-var">newPackageSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Set PackageIteration
</span><a href="Poseidon.Chronicle.html#snapYamlPackages"><span class="hs-identifier hs-var">snapYamlPackages</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503798"><span class="hs-identifier hs-var">newChronicle</span></a></span><span>
</span><span id="line-95"></span><span>        </span><span id="local-6989586621679503802"><span class="annot"><span class="annottext">mergedPacSet :: Set PackageIteration
</span><a href="#local-6989586621679503802"><span class="hs-identifier hs-var hs-var">mergedPacSet</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set PackageIteration
-&gt; Set PackageIteration -&gt; Set PackageIteration
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.union</span></span><span> </span><span class="annot"><span class="annottext">Set PackageIteration
</span><a href="#local-6989586621679503799"><span class="hs-identifier hs-var">oldPackageSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set PackageIteration
</span><a href="#local-6989586621679503800"><span class="hs-identifier hs-var">newPackageSet</span></a></span><span>
</span><span id="line-96"></span><span>        </span><span id="local-6989586621679503804"><span class="annot"><span class="annottext">oldChronicleVersion :: Version
</span><a href="#local-6989586621679503804"><span class="hs-identifier hs-var hs-var">oldChronicleVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Version
</span><a href="Poseidon.Chronicle.html#snapYamlChronicleVersion"><span class="hs-identifier hs-var">snapYamlChronicleVersion</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503797"><span class="hs-identifier hs-var">oldChronicle</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set PackageIteration
</span><a href="#local-6989586621679503802"><span class="hs-identifier hs-var">mergedPacSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set PackageIteration -&gt; Set PackageIteration -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Set PackageIteration
</span><a href="#local-6989586621679503799"><span class="hs-identifier hs-var">oldPackageSet</span></a></span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503797"><span class="hs-identifier hs-var">oldChronicle</span></a></span><span>
</span><span id="line-100"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-101"></span><span>              </span><span class="annot"><span class="annottext">snapYamlTitle :: String
</span><a href="Poseidon.Chronicle.html#snapYamlTitle"><span class="hs-identifier hs-var">snapYamlTitle</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; String
</span><a href="Poseidon.Chronicle.html#snapYamlTitle"><span class="hs-identifier hs-var">snapYamlTitle</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503797"><span class="hs-identifier hs-var">oldChronicle</span></a></span><span>
</span><span id="line-102"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">snapYamlDescription :: Maybe String
</span><a href="Poseidon.Chronicle.html#snapYamlDescription"><span class="hs-identifier hs-var">snapYamlDescription</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Maybe String
</span><a href="Poseidon.Chronicle.html#snapYamlDescription"><span class="hs-identifier hs-var">snapYamlDescription</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503797"><span class="hs-identifier hs-var">oldChronicle</span></a></span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">snapYamlChronicleVersion :: Version
</span><a href="Poseidon.Chronicle.html#snapYamlChronicleVersion"><span class="hs-identifier hs-var">snapYamlChronicleVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VersionComponent -&gt; Version -&gt; Version
</span><a href="Poseidon.Version.html#updateThreeComponentVersion"><span class="hs-identifier hs-var">updateThreeComponentVersion</span></a></span><span> </span><span class="annot"><span class="annottext">VersionComponent
</span><a href="Poseidon.Version.html#Minor"><span class="hs-identifier hs-var">Minor</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503804"><span class="hs-identifier hs-var">oldChronicleVersion</span></a></span><span>
</span><span id="line-104"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">snapYamlLastModified :: Day
</span><a href="Poseidon.Chronicle.html#snapYamlLastModified"><span class="hs-identifier hs-var">snapYamlLastModified</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; Day
</span><a href="Poseidon.Chronicle.html#snapYamlLastModified"><span class="hs-identifier hs-var">snapYamlLastModified</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503798"><span class="hs-identifier hs-var">newChronicle</span></a></span><span>
</span><span id="line-105"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">snapYamlPackages :: Set PackageIteration
</span><a href="Poseidon.Chronicle.html#snapYamlPackages"><span class="hs-identifier hs-var">snapYamlPackages</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set PackageIteration
</span><a href="#local-6989586621679503802"><span class="hs-identifier hs-var">mergedPacSet</span></a></span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><a href="Poseidon.Chronicle.html#readChronicle"><span class="hs-identifier hs-type">readChronicle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Utils.html#PoseidonIO"><span class="hs-identifier hs-type">PoseidonIO</span></a></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span><span>
</span><span id="line-109"></span><span id="readChronicle"><span class="annot"><span class="annottext">readChronicle :: String -&gt; PoseidonIO PoseidonPackageChronicle
</span><a href="Poseidon.Chronicle.html#readChronicle"><span class="hs-identifier hs-var hs-var">readChronicle</span></a></span></span><span> </span><span id="local-6989586621679503807"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503807"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679503808"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679503808"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ReaderT Env IO ByteString
forall a. IO a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ReaderT Env IO ByteString)
-&gt; IO ByteString -&gt; ReaderT Env IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">B.readFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503807"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either ParseException PoseidonPackageChronicle
forall a. FromJSON a =&gt; ByteString -&gt; Either ParseException a
</span><span class="hs-identifier hs-var">decodeEither'</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679503808"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679503810"><span class="annot"><span class="annottext">ParseException
</span><a href="#local-6989586621679503810"><span class="hs-identifier hs-var">err</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PoseidonException -&gt; PoseidonIO PoseidonPackageChronicle
forall e a. Exception e =&gt; e -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(PoseidonException -&gt; PoseidonIO PoseidonPackageChronicle)
-&gt; PoseidonException -&gt; PoseidonIO PoseidonPackageChronicle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ParseException -&gt; PoseidonException
</span><a href="Poseidon.Utils.html#PoseidonYamlParseException"><span class="hs-identifier hs-var">PoseidonYamlParseException</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503807"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">ParseException
</span><a href="#local-6989586621679503810"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679503812"><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503812"><span class="hs-identifier hs-var">snap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; PoseidonIO PoseidonPackageChronicle
forall a. a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503812"><span class="hs-identifier hs-var">snap</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="annot"><a href="Poseidon.Chronicle.html#writeChronicle"><span class="hs-identifier hs-type">writeChronicle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Utils.html#PoseidonIO"><span class="hs-identifier hs-type">PoseidonIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span id="writeChronicle"><span class="annot"><span class="annottext">writeChronicle :: String -&gt; PoseidonPackageChronicle -&gt; PoseidonIO ()
</span><a href="Poseidon.Chronicle.html#writeChronicle"><span class="hs-identifier hs-var hs-var">writeChronicle</span></a></span></span><span> </span><span id="local-6989586621679503814"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503814"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679503815"><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503815"><span class="hs-identifier hs-var">snapShot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; PoseidonIO ()
forall a. IO a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PoseidonIO ()) -&gt; IO () -&gt; PoseidonIO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">createDirectoryIfMissing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503814"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; PoseidonIO ()
forall a. IO a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PoseidonIO ()) -&gt; IO () -&gt; PoseidonIO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">B.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503814"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Config -&gt; PoseidonPackageChronicle -&gt; ByteString
forall a. ToJSON a =&gt; Config -&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encodePretty</span></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679503817"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackageChronicle
</span><a href="#local-6989586621679503815"><span class="hs-identifier hs-var">snapShot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-120"></span><span>        </span><span id="local-6989586621679503817"><span class="annot"><span class="annottext">opts :: Config
</span><a href="#local-6989586621679503817"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Config -&gt; Config
</span><span class="hs-identifier hs-var">setConfDropNull</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(Config -&gt; Config) -&gt; Config -&gt; Config
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text -&gt; Ordering) -&gt; Config -&gt; Config
</span><span class="hs-identifier hs-var">setConfCompare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Ordering)
-&gt; (Text -&gt; Int) -&gt; Text -&gt; Text -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><a href="#local-6989586621679503819"><span class="hs-identifier hs-var">fieldIndex</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Config
</span><span class="hs-identifier hs-var">defConfig</span></span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621679503819"><span class="annot"><span class="annottext">fieldIndex :: Text -&gt; Int
</span><a href="#local-6989586621679503819"><span class="hs-identifier hs-var hs-var">fieldIndex</span></a></span></span><span> </span><span id="local-6989586621679503824"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679503824"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679503826"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679503824"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><span class="hs-operator hs-var">`elemIndex`</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679503826"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span id="local-6989586621679503826"><span class="annot"><span class="annottext">fields :: [Text]
</span><a href="#local-6989586621679503826"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-123"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;title&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;description&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;chronicleVersion&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;lastModified&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;packages&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;title&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;version&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;commit&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;path&quot;</span></span><span>
</span><span id="line-132"></span><span>         </span><span class="hs-special">]</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><a href="Poseidon.Chronicle.html#makeChronicle"><span class="hs-identifier hs-type">makeChronicle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Poseidon.Package.html#PoseidonPackage"><span class="hs-identifier hs-type">PoseidonPackage</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Utils.html#PoseidonIO"><span class="hs-identifier hs-type">PoseidonIO</span></a></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span><span>
</span><span id="line-135"></span><span id="makeChronicle"><span class="annot"><span class="annottext">makeChronicle :: String -&gt; [PoseidonPackage] -&gt; PoseidonIO PoseidonPackageChronicle
</span><a href="Poseidon.Chronicle.html#makeChronicle"><span class="hs-identifier hs-var hs-var">makeChronicle</span></a></span></span><span> </span><span id="local-6989586621679503838"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503838"><span class="hs-identifier hs-var">pathToChronicleFile</span></a></span></span><span> </span><span id="local-6989586621679503839"><span class="annot"><span class="annottext">[PoseidonPackage]
</span><a href="#local-6989586621679503839"><span class="hs-identifier hs-var">pacs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679503840"><span class="annot"><span class="annottext">Set PackageIteration
</span><a href="#local-6989586621679503840"><span class="hs-identifier hs-var">pacChronicles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; [PoseidonPackage] -&gt; PoseidonIO (Set PackageIteration)
</span><a href="Poseidon.Chronicle.html#chroniclePackages"><span class="hs-identifier hs-var">chroniclePackages</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503838"><span class="hs-identifier hs-var">pathToChronicleFile</span></a></span><span> </span><span class="annot"><span class="annottext">[PoseidonPackage]
</span><a href="#local-6989586621679503839"><span class="hs-identifier hs-var">pacs</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span> </span><span id="local-6989586621679503843"><span class="annot"><span class="annottext">Day
</span><a href="#local-6989586621679503843"><span class="hs-identifier hs-var">today</span></a></span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime -&gt; ReaderT Env IO UTCTime
forall a. IO a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><span class="hs-identifier hs-var">getCurrentTime</span></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">PoseidonPackageChronicle -&gt; PoseidonIO PoseidonPackageChronicle
forall a. a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PoseidonPackageChronicle -&gt; PoseidonIO PoseidonPackageChronicle)
-&gt; PoseidonPackageChronicle -&gt; PoseidonIO PoseidonPackageChronicle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PoseidonPackageChronicle"><span class="hs-identifier hs-type">PoseidonPackageChronicle</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><span class="annottext">snapYamlTitle :: String
</span><a href="Poseidon.Chronicle.html#snapYamlTitle"><span class="hs-identifier hs-var">snapYamlTitle</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Chronicle title&quot;</span></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">snapYamlDescription :: Maybe String
</span><a href="Poseidon.Chronicle.html#snapYamlDescription"><span class="hs-identifier hs-var">snapYamlDescription</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Chronicle description&quot;</span></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">snapYamlChronicleVersion :: Version
</span><a href="Poseidon.Chronicle.html#snapYamlChronicleVersion"><span class="hs-identifier hs-var">snapYamlChronicleVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Version
</span><span class="hs-identifier hs-var">makeVersion</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">snapYamlLastModified :: Day
</span><a href="Poseidon.Chronicle.html#snapYamlLastModified"><span class="hs-identifier hs-var">snapYamlLastModified</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Day
</span><a href="#local-6989586621679503843"><span class="hs-identifier hs-var">today</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">snapYamlPackages :: Set PackageIteration
</span><a href="Poseidon.Chronicle.html#snapYamlPackages"><span class="hs-identifier hs-var">snapYamlPackages</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set PackageIteration
</span><a href="#local-6989586621679503840"><span class="hs-identifier hs-var">pacChronicles</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="Poseidon.Chronicle.html#chroniclePackages"><span class="hs-identifier hs-type">chroniclePackages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Poseidon.Package.html#PoseidonPackage"><span class="hs-identifier hs-type">PoseidonPackage</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Utils.html#PoseidonIO"><span class="hs-identifier hs-type">PoseidonIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span id="chroniclePackages"><span class="annot"><span class="annottext">chroniclePackages :: String -&gt; [PoseidonPackage] -&gt; PoseidonIO (Set PackageIteration)
</span><a href="Poseidon.Chronicle.html#chroniclePackages"><span class="hs-identifier hs-var hs-var">chroniclePackages</span></a></span></span><span> </span><span id="local-6989586621679503844"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503844"><span class="hs-identifier hs-var">pathToChronicleFile</span></a></span></span><span> </span><span id="local-6989586621679503845"><span class="annot"><span class="annottext">[PoseidonPackage]
</span><a href="#local-6989586621679503845"><span class="hs-identifier hs-var">pacs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679503846"><span class="annot"><span class="annottext">[PackageIteration]
</span><a href="#local-6989586621679503846"><span class="hs-identifier hs-var">pacStateList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PoseidonPackage -&gt; ReaderT Env IO PackageIteration)
-&gt; [PoseidonPackage] -&gt; ReaderT Env IO [PackageIteration]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">PoseidonPackage -&gt; ReaderT Env IO PackageIteration
</span><a href="#local-6989586621679503848"><span class="hs-identifier hs-var">snapOne</span></a></span><span> </span><span class="annot"><span class="annottext">[PoseidonPackage]
</span><a href="#local-6989586621679503845"><span class="hs-identifier hs-var">pacs</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">Set PackageIteration -&gt; PoseidonIO (Set PackageIteration)
forall a. a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Set PackageIteration -&gt; PoseidonIO (Set PackageIteration))
-&gt; Set PackageIteration -&gt; PoseidonIO (Set PackageIteration)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PackageIteration] -&gt; Set PackageIteration
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[PackageIteration]
</span><a href="#local-6989586621679503846"><span class="hs-identifier hs-var">pacStateList</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>        </span><span class="annot"><a href="#local-6989586621679503848"><span class="hs-identifier hs-type">snapOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Poseidon.Package.html#PoseidonPackage"><span class="hs-identifier hs-type">PoseidonPackage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Utils.html#PoseidonIO"><span class="hs-identifier hs-type">PoseidonIO</span></a></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span>
</span><span id="line-152"></span><span>        </span><span id="local-6989586621679503848"><span class="annot"><span class="annottext">snapOne :: PoseidonPackage -&gt; ReaderT Env IO PackageIteration
</span><a href="#local-6989586621679503848"><span class="hs-identifier hs-var hs-var">snapOne</span></a></span></span><span> </span><span id="local-6989586621679503850"><span class="annot"><span class="annottext">PoseidonPackage
</span><a href="#local-6989586621679503850"><span class="hs-identifier hs-var">pac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-153"></span><span>            </span><span id="local-6989586621679503851"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503851"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PoseidonPackage -&gt; PoseidonIO Version
</span><a href="Poseidon.Chronicle.html#getPackageVersion"><span class="hs-identifier hs-var">getPackageVersion</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackage
</span><a href="#local-6989586621679503850"><span class="hs-identifier hs-var">pac</span></a></span><span>
</span><span id="line-154"></span><span>            </span><span id="local-6989586621679503853"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503853"><span class="hs-identifier hs-var">commit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; PoseidonIO String
</span><a href="Poseidon.Chronicle.html#getGitCommitHash"><span class="hs-identifier hs-var">getGitCommitHash</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PoseidonIO String) -&gt; String -&gt; PoseidonIO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PoseidonPackage -&gt; String
</span><a href="Poseidon.Package.html#posPacBaseDir"><span class="hs-identifier hs-var">posPacBaseDir</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackage
</span><a href="#local-6989586621679503850"><span class="hs-identifier hs-var">pac</span></a></span><span>
</span><span id="line-155"></span><span>            </span><span class="annot"><span class="annottext">PackageIteration -&gt; ReaderT Env IO PackageIteration
forall a. a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PackageIteration -&gt; ReaderT Env IO PackageIteration)
-&gt; PackageIteration -&gt; ReaderT Env IO PackageIteration
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Poseidon.Chronicle.html#PackageIteration"><span class="hs-identifier hs-type">PackageIteration</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-156"></span><span>                </span><span class="annot"><span class="annottext">pacStateTitle :: String
</span><a href="Poseidon.Chronicle.html#pacStateTitle"><span class="hs-identifier hs-var">pacStateTitle</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoseidonPackage -&gt; String
forall a. HasNameAndVersion a =&gt; a -&gt; String
</span><a href="Poseidon.EntityTypes.html#getPacName"><span class="hs-identifier hs-var">getPacName</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackage
</span><a href="#local-6989586621679503850"><span class="hs-identifier hs-var">pac</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>                </span><span class="annot"><span class="annottext">pacStateVersion :: Version
</span><a href="Poseidon.Chronicle.html#pacStateVersion"><span class="hs-identifier hs-var">pacStateVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503851"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>                </span><span class="annot"><span class="annottext">pacStateCommit :: String
</span><a href="Poseidon.Chronicle.html#pacStateCommit"><span class="hs-identifier hs-var">pacStateCommit</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503853"><span class="hs-identifier hs-var">commit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>                </span><span class="annot"><span class="annottext">pacStatePath :: String
</span><a href="Poseidon.Chronicle.html#pacStatePath"><span class="hs-identifier hs-var">pacStatePath</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">makeRelative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503844"><span class="hs-identifier hs-var">pathToChronicleFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PoseidonPackage -&gt; String
</span><a href="Poseidon.Package.html#posPacBaseDir"><span class="hs-identifier hs-var">posPacBaseDir</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackage
</span><a href="#local-6989586621679503850"><span class="hs-identifier hs-var">pac</span></a></span><span>
</span><span id="line-160"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="annot"><a href="Poseidon.Chronicle.html#getPackageVersion"><span class="hs-identifier hs-type">getPackageVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Poseidon.Package.html#PoseidonPackage"><span class="hs-identifier hs-type">PoseidonPackage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Utils.html#PoseidonIO"><span class="hs-identifier hs-type">PoseidonIO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Version</span></span><span>
</span><span id="line-163"></span><span id="getPackageVersion"><span class="annot"><span class="annottext">getPackageVersion :: PoseidonPackage -&gt; PoseidonIO Version
</span><a href="Poseidon.Chronicle.html#getPackageVersion"><span class="hs-identifier hs-var hs-var">getPackageVersion</span></a></span></span><span> </span><span id="local-6989586621679503856"><span class="annot"><span class="annottext">PoseidonPackage
</span><a href="#local-6989586621679503856"><span class="hs-identifier hs-var">pac</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PoseidonPackage -&gt; Maybe Version
forall a. HasNameAndVersion a =&gt; a -&gt; Maybe Version
</span><a href="Poseidon.EntityTypes.html#getPacVersion"><span class="hs-identifier hs-var">getPacVersion</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackage
</span><a href="#local-6989586621679503856"><span class="hs-identifier hs-var">pac</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679503857"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503857"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Version -&gt; PoseidonIO Version
forall a. a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679503857"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">Maybe Version
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>            </span><span id="local-6989586621679503858"><span class="annot"><span class="annottext">TestMode
</span><a href="#local-6989586621679503858"><span class="hs-identifier hs-var">testMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; TestMode) -&gt; ReaderT Env IO TestMode
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; TestMode
</span><a href="Poseidon.Utils.html#_envTestMode"><span class="hs-identifier hs-var">_envTestMode</span></a></span><span>
</span><span id="line-168"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TestMode
</span><a href="#local-6989586621679503858"><span class="hs-identifier hs-var">testMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>                </span><span class="annot"><span class="annottext">TestMode
</span><a href="Poseidon.Utils.html#Testing"><span class="hs-identifier hs-var">Testing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Version -&gt; PoseidonIO Version
forall a. a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Version -&gt; PoseidonIO Version) -&gt; Version -&gt; PoseidonIO Version
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Version
</span><span class="hs-identifier hs-var">makeVersion</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span>                </span><span class="annot"><span class="annottext">TestMode
</span><a href="Poseidon.Utils.html#Production"><span class="hs-identifier hs-var">Production</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>                    </span><span class="annot"><span class="annottext">PoseidonException -&gt; PoseidonIO Version
forall e a. Exception e =&gt; e -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(PoseidonException -&gt; PoseidonIO Version)
-&gt; PoseidonException -&gt; PoseidonIO Version
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; PoseidonException
</span><a href="Poseidon.Utils.html#PoseidonChronicleException"><span class="hs-identifier hs-var">PoseidonChronicleException</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PoseidonException) -&gt; String -&gt; PoseidonException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-172"></span><span>                        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Package &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ShowS
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoseidonPackage -&gt; String
forall a. HasNameAndVersion a =&gt; a -&gt; String
</span><a href="Poseidon.EntityTypes.html#getPacName"><span class="hs-identifier hs-var">getPacName</span></a></span><span> </span><span class="annot"><span class="annottext">PoseidonPackage
</span><a href="#local-6989586621679503856"><span class="hs-identifier hs-var">pac</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; has no version.&quot;</span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="annot"><a href="Poseidon.Chronicle.html#getGitCommitHash"><span class="hs-identifier hs-type">getGitCommitHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Poseidon.Utils.html#PoseidonIO"><span class="hs-identifier hs-type">PoseidonIO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-175"></span><span id="getGitCommitHash"><span class="annot"><span class="annottext">getGitCommitHash :: String -&gt; PoseidonIO String
</span><a href="Poseidon.Chronicle.html#getGitCommitHash"><span class="hs-identifier hs-var hs-var">getGitCommitHash</span></a></span></span><span> </span><span id="local-6989586621679503864"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503864"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621679503865"><span class="annot"><span class="annottext">TestMode
</span><a href="#local-6989586621679503865"><span class="hs-identifier hs-var">testMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; TestMode) -&gt; ReaderT Env IO TestMode
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; TestMode
</span><a href="Poseidon.Utils.html#_envTestMode"><span class="hs-identifier hs-var">_envTestMode</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TestMode
</span><a href="#local-6989586621679503865"><span class="hs-identifier hs-var">testMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><span class="annottext">TestMode
</span><a href="Poseidon.Utils.html#Testing"><span class="hs-identifier hs-var">Testing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PoseidonIO String
forall a. a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TestMode Git hash&quot;</span></span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><span class="annottext">TestMode
</span><a href="Poseidon.Utils.html#Production"><span class="hs-identifier hs-var">Production</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>            </span><span id="local-6989586621679503866"><span class="annot"><span class="annottext">Either GitHashException GitInfo
</span><a href="#local-6989586621679503866"><span class="hs-identifier hs-var">eitherGit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either GitHashException GitInfo)
-&gt; ReaderT Env IO (Either GitHashException GitInfo)
forall a. IO a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either GitHashException GitInfo)
 -&gt; ReaderT Env IO (Either GitHashException GitInfo))
-&gt; IO (Either GitHashException GitInfo)
-&gt; ReaderT Env IO (Either GitHashException GitInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Either GitHashException GitInfo)
</span><span class="hs-identifier hs-var">getGitInfo</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503864"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-181"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either GitHashException GitInfo
</span><a href="#local-6989586621679503866"><span class="hs-identifier hs-var">eitherGit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-182"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">GitHashException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>                    </span><span id="local-6989586621679503867"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503867"><span class="hs-identifier hs-var">pAbsolute</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; PoseidonIO String
forall a. IO a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; PoseidonIO String) -&gt; IO String -&gt; PoseidonIO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">makeAbsolute</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503864"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-184"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679503868"><span class="annot"><span class="annottext">oneLevelUp :: String
</span><a href="#local-6989586621679503868"><span class="hs-identifier hs-var hs-var">oneLevelUp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503867"><span class="hs-identifier hs-var">pAbsolute</span></a></span><span>
</span><span id="line-185"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503868"><span class="hs-identifier hs-var">oneLevelUp</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503868"><span class="hs-identifier hs-var">oneLevelUp</span></a></span><span>
</span><span id="line-186"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">String -&gt; PoseidonIO String
forall a. a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No Git repository found&quot;</span></span><span>
</span><span id="line-187"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; PoseidonIO String
</span><a href="Poseidon.Chronicle.html#getGitCommitHash"><span class="hs-identifier hs-var">getGitCommitHash</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679503868"><span class="hs-identifier hs-var">oneLevelUp</span></a></span><span>
</span><span id="line-188"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679503869"><span class="annot"><span class="annottext">GitInfo
</span><a href="#local-6989586621679503869"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; PoseidonIO String
forall a. a -&gt; ReaderT Env IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PoseidonIO String) -&gt; String -&gt; PoseidonIO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GitInfo -&gt; String
</span><span class="hs-identifier hs-var">giHash</span></span><span> </span><span class="annot"><span class="annottext">GitInfo
</span><a href="#local-6989586621679503869"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-190"></span></pre></body></html>